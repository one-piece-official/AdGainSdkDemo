# 开屏广告

> 参考 [Demo](https://github.com/one-piece-official/GtAndroidSdkDemo.git)

## 1. 开屏API介绍

###  1.1 SplashAd
> com.gt.sdk.api.SplashAd

| 方法名 | 方法介绍 |
| --- | --- |
| SplashAd(AdRequest adRequest, SplashAdListener adListener) | 构造方法，广告相关状态会通过 adListener 通知开发者。参数说明：adRequest（广告请求对象）、adListener（广告状态监听器）。      |
| void loadAd() | 请求广告。   |
| boolean isReady() | 广告是否准备好，未准备好广告将无法展示。                     |
| void showAd(ViewGroup adContainer) | 展示广告。参数说明：adContainer（展示广告的容器不可为null） |
| void destroyAd() | 当广告关闭不再使用时，必须调用此方法释放资源 |

###  1.2 AdRequest
> com.gt.sdk.api.AdRequest.Builder<br>
> 参数设置接口可链式调用，最后调用`build()`方法

| 方法名 | 方法介绍 |
| --- | --- |
| Builder setAdUnitID(String adUnitID) | 设置广告位ID。参数说明：adUnitID（广告位Id）。 |
| Builder setWidth(int width) | 设置开屏广告view的宽度。 |
| Builder setHeight(int height) | 设置开屏广告view的高度。  |
| Builder setBidFloor(int bidFloor) | 设置广告请求的底价，单位分。 |
| Builder setExtOption(Map\<String, Object> option) | 设置扩展参数。参数说明：options（扩展参数，可传任意）。 |
| Builder setSplashAdLoadTimeoutMs(long splashAdLoadTimeoutMs) | 设置开屏广告加载超时时间（单位 ms）。 |
| AdRequest build() | 构建AdRequest对象。 |

###  1.3 SplashAdListener
> com.gt.sdk.api.SplashAdListener

| 方法名 | 方法介绍 |
| --- | --- |
| void onSplashAdLoadSuccess(String adUnitID, GTAdInfo adInfo) | 开屏广告成功加载。参数说明：adUnitID（请求的广告位Id）、adInfo（请求到的广告信息对象）。 |
| void onSplashAdLoadFail(String adUnitID,	 AdError error) | 开屏广告加载失败。参数说明：adUnitID（报错的广告位Id）、error（报错信息，具体可看其内部code和message）。 |
| void onSplashAdShow(String adUnitID, GTAdInfo adInfo) | 开屏广告成功展示，媒体可在此记录曝光。参数说明：adUnitID（广告位Id）、adInfo（展示的广告信息对象）。 |
| void onSplashAdClick(String adUnitID, GTAdInfo adInfo) | 开屏广告被点击。参数说明：adUnitID（广告位Id）、adInfo（广告信息对象）。                |
| void onSplashAdShowError(String adUnitID, AdError error) | 开屏广告展示失败。参数说明：adUnitID（广告位Id）、error（报错信息，具体可看其内部code和message）。 |
| void onSplashAdClose(String adUnitID, GTAdInfo adInfo) | 开屏广告关闭。参数说明：adUnitID（广告位Id）、adInfo（广告信息对象）。 |


## 2. 接入代码示例
> 可参考Demo中的 [SplashDemoActivity 实现](https://github.com/one-piece-official/GtAndroidSdkDemo/blob/main/app/src/main/java/com/gt/demo/SplashDemoActivity.java)

### 2.1 设置监听回调
```java
SplashAdListener mSplashAdListener = new SplashAdListener() {

    // 开屏广告加载成功通知，加载成功后才可以展示广告
    @Override
    public void onSplashAdLoadSuccess(String adUnitID, GTAdInfo adInfo) {
        Log.d(Constants.LOG_TAG, "----------onSplashAdLoadSuccess----------" + splashAd.isReady() + ":" + adUnitID   + "  adInfo = " + adInfo);
        logs.add("onSplashAdLoadSuccess:" + splashAd.isReady());

        if (splashAd != null && splashAd.isReady()) {
            // 执行展示广告
            splashAd.showAd(mViewGroup);
        }
    }

    // 开屏广告加载失败通知
    @Override
    public void onSplashAdLoadFail(String adUnitID, AdError error) {
        Log.d(Constants.LOG_TAG, "----------onSplashAdLoadFail----------" + error.toString() + ":" + adUnitID);
        logs.add("onSplashAdLoadFail: " + error + " placementId: " + adUnitID);
        jumpMainActivity();
    }

    @Override
    public void onSplashAdShow(String adUnitID, GTAdInfo adInfo) {
        Log.d(Constants.LOG_TAG, "----------onSplashAdShow----------" + adUnitID  + "  adInfo = " + adInfo);
        logs.add("onSplashAdShow");
    }

    // 开屏广告展示错误
    @Override
    public void onSplashAdShowError(String adUnitID, AdError error) {
        Log.d(Constants.LOG_TAG, "----------onSplashAdShowError----------" + error.toString() + ":" + adUnitID);
        logs.add("onSplashAdShowError: " + error + " placementId: " + adUnitID);
        jumpMainActivity();
    }

    // 开屏广告被用户点击通知
    @Override
    public void onSplashAdClick(String adUnitID, GTAdInfo adInfo) {
        Log.d(Constants.LOG_TAG, "----------onSplashAdClick----------" + adInfo  + "  adInfo = " + adInfo);
        logs.add("onSplashAdClick");
    }

    // 开屏广告关闭通知
    @Override
    public void onSplashAdClose(String adUnitID, GTAdInfo adInfo) {
        Log.d(Constants.LOG_TAG, "----------onSplashAdClose----------" + adUnitID  + "  adInfo = " + adInfo);
        logs.add("onSplashAdClose");
        jumpWhenCanClick();
    }
};
```

### 2.2 开屏广告点击注意事项

```java
/**
 * 当设置开屏可点击时，需要等待跳转页面关闭后，再切换至您的主窗口。
 * 故此时需要增加canJumpImmediately判断。 另外，点击开屏还需要在onResume中调用jumpWhenCanClick接口。
 */
public boolean canJumpImmediately = false;

private void jumpWhenCanClick() {
    if (canJumpImmediately) {
        jumpMainActivity();
    } else {
        canJumpImmediately = true;
    }
}

/**
 * 不可点击的开屏，使用该jump方法，而不是用jumpWhenCanClick
 */
private void jumpMainActivity() {
    Intent intent = new Intent(this, MainActivity.class);
    this.startActivity(intent);
    this.finish();
}

@Override
protected void onPause() {
    canJumpImmediately = false;
}

@Override
protected void onResume() {
    if (canJumpImmediately) {
        jumpWhenCanClick();
    }
    canJumpImmediately = true;
}
```

### 2.3 开屏广告加载

```java
Map<String, Object> options = new HashMap<>();
options.put("user_id", "");
options.put("splash_self_key", "splash_self_value");

// 创建ad请求
AdRequest adRequest = new AdRequest.Builder()
        .setAdUnitID(Constants.SPLASH_ADUNITID) // 广告位ID
        .setWidth(PxUtils.getDeviceWidthInPixel(this)) // 设置需要的广告视图宽度
        .setHeight(PxUtils.getDeviceHeightInPixel(this) - PxUtils.dpToPx(this,100)) // 设置需要的广告视图高度
        .setExtOption(options) // 设置透传的自定义数据
        .setSplashAdLoadTimeoutMs(5 * 1000) // 设置开屏广告加载的超时时间（单位：ms），如果这个时间段内广告加载失败会给出超时错误回调
        .build();
// 创建开屏AD API对象，监听回调在这里设置
splashAd = new SplashAd(adRequest, mSplashAdListener);
// 加载广告 els
splashAd.loadAd(); 
```

### 2.4 开屏广告展示

```java
// 展示前先判断广告是否ready
if (splashAd != null && splashAd.isReady()) {
    splashAd.showAd(splashLY);
} else {
   Log.d("TAG", "splashAd is not ready or splashAd is null");
} 
```
### 2.5 开屏广告销毁

```java
// 界面销毁时，执行销毁Ad接口
if (splashAd != null) {
    splashAd.destroyAd();
    splashAd = null;
} 
```
