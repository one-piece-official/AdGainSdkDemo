# 原生广告（自渲染）

> **注意:** 原生广告具体实现可参考 [Demo](https://github.com/one-piece-official/GtAndroidSdkDemo.git) NativeAdSimpleDemoActivity、NativeAdListDemoActivity、NativeAdRecycleDemoActivity 等
> 
> **自渲染广告:** SDK返回物料，建议由开发者根据自己的广告设计自行UI适配和展示。

## 1. 接入代码示例

### 1.1 原生广告加载

```java

private NativeUnifiedAd nativeAd;
private List<NativeAdData> currentAdDataList;


Map<String, Object> options = new HashMap<>();
options.put("test_extra_key", "test_extra_value");
AdRequest adRequest = new AdRequest
        .Builder()
        .setAdUnitID(adUnitID) // 设置广告位id
        .setExtOption(options) // 自定义参数
        .build();
// 创建广告对象
nativeAd = new NativeUnifiedAd(adRequest, new NativeAdLoadListener() {
    @Override
    public void onAdError(String adUnitID, AdError error) {
        Log.d(Constants.LOG_TAG, "----------onAdError----------:" + error.toString() + ":" + adUnitID);
        logMessage("onAdError() called with: error = [" + error + "], adUnitID = [" + adUnitID + "]");
    }

    @Override
    public void onAdLoad(String adUnitID, List<NativeAdData> adDataList) {
        logMessage("onAdLoad [ " + adUnitID + " ]  ");

        if (adDataList != null && !adDataList.isEmpty()) {
            Log.d(Constants.LOG_TAG, "onAdLoad [ " + adUnitID + " ]  adUnitID = " + adUnitID + "   adDataList = " + adDataList);
            currentAdDataList = adDataList;
        }
    }
});

// 请求广告
nativeAd.loadAd();
```

### 1.2 原生广告展示

> 请参考 [Demo](https://github.com/one-piece-official/GtAndroidSdkDemo.git) 中 `NativeAdUnifiedDemoActivity`、`NativeDemoRender` 类的具体实现

```java

private ViewGroup adContainer;
private List<NativeAdData> currentAdDataList;

/**
 * 展示广告，请在收到onAdLoad回调后再展示广告
 */
List<NativeAdData> unifiedADDataList = currentAdDataList;
if (unifiedADDataList != null && !unifiedADDataList.isEmpty()) {

    NativeAdData nativeAdData = unifiedADDataList.get(0);

    View view = buildView(nativeAdData);
    // 媒体最终将要展示广告的容器
    if (adContainer != null) {
        adContainer.removeAllViews();
        adContainer.addView(view);
    }

} else {
    logMessage("Ad is not Ready");
    Log.d(Constants.LOG_TAG, "--------请先加载广告--------");
}


private View buildView(NativeAdData nativeAdData) {

    //设置广告交互监听
    nativeAdData.setDislikeInteractionCallback(this, new NativeAdData.DislikeInteractionCallback() {

        @Override
        public void onShow() {
            Log.d(Constants.LOG_TAG, "----------onShow----------");
        }

        @Override
        public void onSelected(int position, String value, boolean enforce) {
            Log.d(Constants.LOG_TAG, "----------onSelected----------:" + position + ":" + value + ":" + enforce);
            if (adContainer != null) {
                adContainer.removeAllViews();
            }
            logMessage("onAdClose()");
        }

        @Override
        public void onCancel() {
            Log.d(Constants.LOG_TAG, "----------onCancel----------");
        }
    });

    //媒体自渲染的View
    NativeDemoRender adRender = new NativeDemoRender(this);

    View view = adRender.renderAdView(nativeAdData, new NativeAdEventListener() {

        @Override
        public void onAdExposed() {
            Log.d(Constants.LOG_TAG, "----------onAdExposed----------");
            logMessage("onAdExposed()");
        }

        @Override
        public void onAdClicked() {
            Log.d(Constants.LOG_TAG, "----------onAdClicked----------");
            logMessage("onAdClicked()");
        }

        @Override
        public void onAdRenderFail(AdError error) {
            Log.d(Constants.LOG_TAG, "----------onAdRenderFail----------" + error.toString());
            logMessage("onAdRenderFail() called with: error = [" + error + "]");
        }
    });

    return view;
}
```

### 1.3 原生广告销毁

```java

// 原生广告对象的销毁
if (nativeAd != null) {
    nativeAd.destroyAd();
    nativeAd = null;
}

```

## 2. 原生API介绍


### 2.1 NativeUnifiedAd
> com.gt.sdk.api.NativeUnifiedAd

| 方法名 | 方法介绍 |
| --- | --- |
| NativeUnifiedAd(AdRequest adRequest, NativeAdLoadListener adListener) | 构造方法。参数说明：adRequest（广告请求对象）、adListener（广告状态回调对象）。             |
| void loadAd() | 请求广告。 |
| void destroyAd() | 销毁广告。 |

###  2.2 AdRequest
> com.gt.sdk.api.AdRequest.Builder
> 参数设置接口可链式调用，最后调用`build()`方法

| 方法名 | 方法介绍 |
| --- | --- |
| Builder setAdUnitID(String adUnitID) | 设置广告位ID。参数说明：adUnitID（广告位Id）。 |
| Builder setBidFloor(int bidFloor) | 设置广告请求的底价，单位分。 |
| Builder setExtOption(Map\<String, Object> option) | 设置扩展参数。参数说明：options（扩展参数，可传任意）。 |

### 2.3 NativeAdLoadListener

> com.gt.sdk.api.NativeAdLoadListener

| 方法名 | 方法介绍 |
| --- | --- |
| void onAdLoad(String adUnitID, List<NativeAdData> adDataList) | 广告成功加载。参数说明：adUnitID（广告位Id）、adDataList（返回的广告单元对象）。                   |
| void onAdError(String adUnitID, AdError error) | 广告加载失败。参数说明：adUnitID（报错的广告位Id）、error（报错信息，具体可看其内部code和message）。 |

### 2.4 NativeAdData

> com.gt.sdk.api.NativeAdData

| 方法名 | 方法介绍 |
| --- | --- |
| String getCTAText() | 获取创意按钮文案|
| String getTitle() | 获取广告的Tittle|
| String getDesc() | 获取广告的描述|
| String getAdLogo() | 获取广告的Logo|
| String getIconUrl() | 获取广告的Icon|
| List\<GtImage> getImageList() | 获取广告的图片信息集合：GtImage对象中的宽、高、url等|
| View getWidgetView(int width, int height) | 获取广告的互动组件View|
| int getAdPatternType() | 获取广告样式。取值范围：NativeAdPatternType.NATIVE_UNKNOWN、NativeAdPatternType.NATIVE_BIG_IMAGE_AD、NativeAdPatternType.NATIVE_VIDEO_AD、NativeAdPatternType.NATIVE_GROUP_IMAGE_AD|
| int getAdInteractiveType() | 获取广告交互类型。取值范围：NativeAdInteractiveType.NATIVE_UNKNOWN、NativeAdInteractiveType.NATIVE_BROWSER、NativeAdInteractiveType.NATIVE_DEEP_LINK、NativeAdInteractiveType.NATIVE_DOWNLOAD    |
| AdAppInfo getAdAppInfo() | 获取下载类广告六要素信息，媒体可根据需要自行展示。|
| void startVideo() | 播放视频广告 |
| void pauseVideo() | 暂停视频广告 |
| void resumeVideo() | 恢复视频广告 |
| void stopVideo() | 停止视频广告 |
| int getVideoWidth() | 获取视频广告宽 |
| int getVideoHeight() | 获取视频广告高 |
| void destroy() | 销毁广告单元对象    |
| void bindImageViews(List<ImageView> imageViews, int defaultImageRes) | 图片渲染绑定方法。参数说明：imageViews（需要渲染的ImageView集合）、defaultImageRes（图片渲染失败默认展示的资源）。 |
| void bindViewForInteraction(View view, List<View> clickableViews, List<View> creativeViewList, View disLikeView, View privacyView, NativeAdEventListener nativeAdEventListener) | 绑定广告交互的方法。参数说明：view（自渲染的根View）、clickableViews（可点击的View的列表）、creativeViewList（用于下载或者拨打电话的创意View集合）、disLikeView（dislike按钮View）、privacyView（下载类隐私协议view，没有则传null）、nativeAdEventListener（广告交互监听回调对象）。 |
| void bindMediaView(ViewGroup mediaLayout, NativeAdMediaListener nativeAdMediaListener) | 绑定视频Video方法。参数说明：mediaLayout（装video的容器）、nativeADMediaListener（视频播放监听回调对象）。 |
| void setDislikeInteractionCallback(Activity activity, DislikeInteractionCallback dislikeInteractionCallback) | 设置Dislike监听。参数说明：activity（dislike弹窗的acticity）、dislikeInteractionCallback（dislike监听回调对象）。 |

### 2.5 NativeAdEventListener

> com.gt.sdk.api.NativeAdEventListener

| 方法名 | 方法介绍 |
| --- | --- |
| void onAdExposed() | 广告曝光。 |
| void onAdClicked()| 广告点击。 |
| void onAdRenderFail(AdError error) | 广告展示失败。参数说明：error（报错信息，具体可看其内部code和message）。 |


### 2.6 NativeAdMediaListener

> com.gt.sdk.api.NativeAdData.NativeAdMediaListener

| 方法名 | 方法介绍 |
| --- | --- |
| void onVideoLoad() | 视频加载成功。             |
| void onVideoError(AdError error) | 视频播放失败。参数说明：error（报错信息，具体可看其内部code和message）。 |
| void onVideoStart() | 视频开始播放。 |
| void onVideoPause() | 视频暂停播放。 |
| void onVideoResume() | 视频恢复播放。             |
| void onVideoCompleted() | 视频完成播放。 |


### 2.7 DislikeInteractionCallback

> com.gt.sdk.api.NativeAdData.DislikeInteractionCallback

| 方法名 | 方法介绍 |
| --- | --- |
| void onShow() | Dislike弹窗显示。 |
| void onSelected(int position, String value, boolean enforce) | Dislike弹窗Item点击。参数说明：position（点击的位置）、value（点击的位置的文字选项）、enforce（是否关闭广告）。 |
| void onCancel() | Dislike弹窗取消。 |

### 2.8 安卓下载应用六要素信息

> com.gt.sdk.api.AdAppInfo <br>
>由于国内监管部门要求，在安卓下载类广告中，需要给用户披露下载的应用的六要素信息。开发者可以通过 `getAdAppInfo()` 方法获取。六要素信息包括


| 方法名                   | 方法介绍                              |
| ------------------------ | ------------------------------------- |
| String getAppName()            | 获取应用名称                        |
| String getAuthorName()          | 获取开发者公司名称                  |
| String getPackageName()          | 获取开发者应用包名                 |
| int getAppSize()             | 获取应用大小                          |
| String getVersionName()         | 获取应用版本号                      |
| Stirng getDeveloper()            | 获取应用的开发者名称                 |
| String getPermissionsUrl()      | 获取应用权限列表 URL，以 WebView 渲染 |
| String getPrivacyUrl()           | 获取应用隐私协议 URL,以 WebView 渲染  |


